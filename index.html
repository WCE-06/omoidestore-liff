<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>COMPASSION WORLD 入店退店管理システム</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
window.alert=function(){};
</script>

<style>
body{margin:0;font-family:sans-serif;background:#0b0f1a;color:#e7ecff}
.hidden{display:none}
button{padding:12px;border-radius:10px;border:none;background:#1db954;color:#fff}
input,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal.show{display:flex}
.modalBox{background:#141d33;padding:16px;border-radius:12px;width:90%;max-height:80%;overflow:auto}
</style>
</head>

<body>

<div id="register">
<h2>会員登録</h2>

<input id="sei" placeholder="姓">
<input id="mei" placeholder="名">
<input id="seiKana" placeholder="姓（カナ）">
<input id="meiKana" placeholder="名（カナ）">
<input id="phone" placeholder="電話番号">
<textarea id="address" placeholder="住所"></textarea>

<p>
<a href="#" id="openTerms">利用規約を確認する</a>
</p>

<label>
<input type="checkbox" id="agree" disabled>
規約に同意します
</label>

<br><br>
<button id="submit" disabled>登録を送信</button>
</div>

<div id="actions" class="hidden">
<button onclick="send('in')">入店</button>
<button onclick="send('out')">退店</button>
</div>

<div id="termsModal" class="modal">
<div class="modalBox" id="termsBox">
<h3>利用規約</h3>
<p>（会員利用規約（Ver.1.0 / 2026-01-10）
第1条 目的
本規約は、COMPASSION WORLD 入店退店管理システムを利用するすべての利用者に対し、施設の安全な運営、防犯、未精算対応および緊急時の連絡を目的として、会員情報の取得および利用条件を定めるものです。
第2条 会員登録
本システムを利用して入店または退店を行う場合、初回利用時に以下の会員情報の登録が必要となります。
・姓
・名
・姓（カナ）
・名（カナ）
・住所
・電話番号
利用者は、正確かつ最新の情報を登録するものとします。
第3条 個人情報の利用目的
取得した個人情報は、以下の目的の範囲内で利用します。
・施設の入退店履歴の管理
・未精算、トラブル、緊急時における利用者への連絡
・盗難、万引き、不正行為等が疑われる場合の事実確認
・法令に基づく対応および手続
第4条 個人情報の管理
取得した個人情報は、漏えい、紛失、改ざん等を防止するため、適切な安全管理措置を講じて管理します。
第5条 個人情報の第三者提供
以下の場合を除き、本人の同意なく第三者に提供することはありません。
・法令に基づく場合
・警察、裁判所等の公的機関から正当な要請を受けた場合
・利用者または第三者の生命、身体、財産の保護のために必要な場合
第6条 入店退店の制限
会員登録が完了していない場合、または虚偽の情報が登録されていると判断された場合、本システムによる入店および退店をお断りすることがあります。
第7条 不正行為への対応
万引き、未精算退店、その他不正行為が確認された場合、必要に応じて警察への相談や民事上の請求等の措置を行うことがあります。
第8条 規約の変更
本規約は、必要に応じて予告なく変更されることがあります。変更後の規約は、本システム上に表示された時点で効力を生じます。
第9条 同意の成立
本規約は、利用者が規約内容を確認し、同意の意思表示を行ったうえで会員登録を送信した時点で成立するものとします。）</p>
</div>
</div>

<script>
const LIFF_ID="2008818718-xTQWF4uO";
const GAS_URL="https://script.google.com/macros/s/AKfycbyPUuou2-AYoL689TwmcoQtCiSkS2HcDK-XsE9mFumOby2BYVOD1CAV8b4S6fc_-zMS/exec";

let termsRead=false;

document.getElementById("openTerms").onclick=e=>{
e.preventDefault();
document.getElementById("termsModal").classList.add("show");
};

document.getElementById("termsBox").addEventListener("scroll",e=>{
const el=e.target;
if(el.scrollTop+el.clientHeight>=el.scrollHeight-10){
termsRead=true;
document.getElementById("agree").disabled=false;
}
});

document.getElementById("termsModal").onclick=e=>{
if(e.target.id==="termsModal") e.target.classList.remove("show");
};

document.getElementById("agree").onchange=()=>{
checkReady();
};

["sei","mei","seiKana","meiKana","phone","address"].forEach(id=>{
document.getElementById(id).oninput=checkReady;
});

function checkReady(){
const ok=
termsRead &&
document.getElementById("agree").checked &&
["sei","mei","seiKana","meiKana","phone","address"].every(id=>document.getElementById(id).value.trim());
document.getElementById("submit").disabled=!ok;
}

document.getElementById("submit").onclick=async()=>{
const token=liff.getIDToken();
const p=new URLSearchParams({
action:"profile_set",
id_token:token,
sei:sei.value,
mei:mei.value,
sei_kana:seiKana.value,
mei_kana:meiKana.value,
phone:phone.value,
address:address.value,
consent:true
});
await fetch(GAS_URL+"?"+p.toString());
document.getElementById("register").classList.add("hidden");
document.getElementById("actions").classList.remove("hidden");
};

async function send(action){
const token=liff.getIDToken();
await fetch(GAS_URL+"?action="+action+"&id_token="+token);
}

(async()=>{
await liff.init({liffId:LIFF_ID,withLoginOnExternalBrowser:true});
})();
</script>
</body>
</html>
